<!DOCTYPE html>
<html>
    <head>
        <title>RESULTS</title>
        <link href="assets/prism.css" rel="stylesheet" />
        <link href="assets/global.css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>

    <body data-simplebar>
        <div id="container">
            <div>
                
            </div>
        </div>

        <script async="false">
            async function getRuns(file) {
                let res = await fetch(`https://carbogninalberto.github.io/pyGENP/code/${file}.json`);
                let data = await res.json();
                let container = document.getElementById('container');
                let title = document.createElement('h2');
                title.innerHTML = file.toUpperCase();
                container.append(title);
                Object.keys(data).forEach(key => {
                    if (!key.includes('original')) {
                        let runContainer = document.createElement('div');
                        runContainer.setAttribute('id', `${file}_${key}_tab`);
                        let headerContainer = document.createElement('div');
                        headerContainer.classList.add('code-header');
                        let runTitle = document.createElement('h3');
                        runTitle.innerHTML = key.toUpperCase();
                        let showButton = document.createElement('button');
                        showButton.innerHTML = 'Show Code';
                        showButton.addEventListener('click', (e) => {
                            console.log(e.target)
                            let codeDiv = document.getElementById(`${file}_${key}`);
                            if (codeDiv.classList.contains('hidden')) {
                                codeDiv.classList.remove('hidden');
                                e.target.innerHTML = 'Hide Code';
                            } else {
                                codeDiv.classList.add('hidden')
                                e.target.innerHTML = 'Show Code';
                            }
                        })
                        headerContainer.append(runTitle);
                        headerContainer.append(showButton);
                        runContainer.append(headerContainer);

                        let codeContainer = document.createElement('div');
                        codeContainer.setAttribute('id', `${file}_${key}`);
                        codeContainer.classList.add('pre-container');
                        codeContainer.classList.add('hidden');
                        
                        let resNodeOriginal = document.createElement('pre');
                        resNodeOriginal.classList.add('language-cpp');
                        resNodeOriginal.classList.add('line-numbers');
                        let codeNodeOriginal = document.createElement('code');
                        codeNodeOriginal.classList.add('language-cpp');
                        codeNodeOriginal.classList.add('line-numbers');
                        console.log("getting", `${key}_original`)
                        codeNodeOriginal.innerHTML = data[`${key}_original`];
                        resNodeOriginal.append(codeNodeOriginal);

                        // compacted
                        let resNode = document.createElement('pre');
                        resNode.classList.add('language-cpp');
                        resNode.classList.add('line-numbers');
                        let codeNode = document.createElement('code');
                        codeNode.classList.add('language-cpp');
                        codeNode.classList.add('line-numbers');
                        codeNode.innerHTML = data[key];
                        resNode.append(codeNode);

                        codeContainer.append(resNodeOriginal);
                        codeContainer.append(resNode);

                        runContainer.append(codeContainer);
                        container.append(runContainer);
                    }
                   
                })
            }


            window.addEventListener('DOMContentLoaded', async () => {
                await getRuns('50_GEN_RUNS');
                await getRuns('50_GEN_RUNS_BIC');

                Prism.hooks.add('after-highlight', function (env) {
                    // works only for <code> wrapped inside <pre data-line-numbers> (not inline)
                    var pre = env.element.parentNode;
                    if (!pre || !/pre/i.test(pre.nodeName) || pre.className.indexOf('line-numbers') === -1) {
                        return;
                    }

                    var linesNum = (1 + env.code.split('\n').length);
                    var lineNumbersWrapper;

                    lines = new Array(linesNum);
                    lines = lines.join('<span></span>');

                    lineNumbersWrapper = document.createElement('span');
                    lineNumbersWrapper.className = 'line-numbers-rows';
                    lineNumbersWrapper.innerHTML = lines;

                    if (pre.hasAttribute('data-start')) {
                        pre.style.counterReset = 'linenumber ' + (parseInt(pre.getAttribute('data-start'), 10) - 1);
                    }

                    env.element.appendChild(lineNumbersWrapper);

                });
                Prism.highlightAll();
            });
            
            
        </script>
        <script src="assets/prism.js" defer></script>
    </body>
</html>